{% import "macros/html.html" as macros %}
<h3>Premium Schedule {{ rank }} : {{ premium_schedule.product.name }}</h3>
<p>Agreement code: {{ premium_schedule.agreement_code }}</p>

{% for data in account_data %}
    {% set total_amount = data.from_value %}
    {% if not data.unit_linked %}
        {% set rows = [['Book', 'Document', 'Document Date', 'Amount', 'Saldo']] %}
        {% do rows.append(['',
                           '',
                           from_document_date|date,
                           total_amount|currency,
                           total_amount|currency,
                           ]) %}
        {% for entry in data.entries%}
            {% set total_amount = total_amount + (entry.amount * -1) %}
            {% do rows.append([entry.book,
                               entry.document,
                               entry.doc_date|date,
                               (entry.amount * -1)|currency,
                               total_amount|currency
                               ]) %}
        {% endfor %}
        {{macros.table(rows,
                       title=data.name|title,
                       first_row_header=true,
                       checkbox=false,
                       color_cycle=false,
                       alignments=['', '', 'right', 'right', 'right'])}}
        Value : {{ data.thru_value|currency }} <br/>
    {% else %}
        {% set total_quantity = data.from_quantity %}
        {% set rows = [['Book', 'Document', 'Document Date', 'Amount', 'Quantity', 'Saldo Amount', 'Saldo Quantity']] %}
        {% do rows.append(['',
                           '',
                           from_document_date|date,
                           total_amount|currency,
                           total_quantity|percentage,
                           total_amount|currency,
                           total_quantity|percentage,
                           ]) %}
        {% for entry in data.entries%}
            {% set total_amount = total_amount + (entry.amount * -1) %}
            {% set total_quantity = total_quantity + entry.quantity %}
            {% do rows.append([entry.book,
                               entry.document,
                               entry.doc_date|date,
                               (entry.amount * -1)|currency,
                               entry.quantity|percentage,
                               total_amount|currency,
                               total_quantity|percentage
                               ]) %}
        {% endfor %}
        {{macros.table(rows,
                       title='Invested - ' + data.name,
                       first_row_header=true,
                       checkbox=false,
                       color_cycle=false,
                       alignments=['', '', 'right', 'right', 'right', 'right', 'right'])}}
        Value : {{ data.thru_value|currency }} <br/>
        Quantity : {{ data.thru_quantity|percentage }} <br/>
    {% endif %}
{% endfor %}
